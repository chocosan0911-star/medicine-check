<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ãŠè–¬ãƒã‚§ãƒƒã‚¯</title>

  <link rel="manifest" href="manifest.json">

  <style>
    body { font-family: sans-serif; text-align:center; padding:30px; }
    h1 { font-size:28px; }

    /* å…±é€š */
    .hidden { display:none; }

    /* ãƒ¡ã‚¤ãƒ³ç”»é¢ */
    #timeMessage { font-size:20px; margin:20px; padding:15px; border-radius:10px; }
    .normal { background:#e0e0e0; }
    .time-alert { background:#4caf50; color:white; font-weight:bold; }
    .missed { background:#f44336; color:white; font-weight:bold; }
    button { font-size:20px; padding:15px 30px; border-radius:10px; border:none; background:#2196f3; color:white; margin:5px; }
    #lastTime { font-size:18px; margin-top:20px; }

    /* æ©Ÿèƒ½ã¾ã¨ã‚ç”»é¢ */
    #featurePage { text-align:left; max-width:600px; margin:0 auto; }
    #featurePage h2 { text-align:center; }
    #featurePage ul { padding-left:20px; }
  </style>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    emailjs.init("OjzEQ0J-l-_Qwh3ci"); // â†è‡ªåˆ†ã®Public Key
  </script>
</head>

<body>

<!-- ================= ãƒ¡ã‚¤ãƒ³ç”»é¢ ================= -->
<div id="mainPage">
  <h1>ğŸ’Š ãŠè–¬ãƒã‚§ãƒƒã‚¯</h1>

  <!-- æ©Ÿèƒ½ã¾ã¨ã‚ã¸é·ç§»ãƒœã‚¿ãƒ³ -->
  <button id="toFeatureBtn">ã‚¢ãƒ—ãƒªæ©Ÿèƒ½ã‚’è¦‹ã‚‹</button>

  <div id="timeMessage" class="normal"></div>
  <button id="takeBtn">é£²ã‚“ã </button>
  <p id="lastTime">ã¾ã é£²ã‚“ã§ã„ã¾ã›ã‚“</p>
</div>

<!-- ================= æ©Ÿèƒ½ã¾ã¨ã‚ç”»é¢ ================= -->
<div id="featurePage" class="hidden">
  <h2>ğŸ’Š ãŠè–¬ãƒã‚§ãƒƒã‚¯ã‚¢ãƒ—ãƒªæ©Ÿèƒ½ã¾ã¨ã‚</h2>
  <ul>
    <li>1ï¸âƒ£ <b>æ™‚é–“é€šçŸ¥</b>
      <ul>
        <li>æœ 7:00 ã¨ å¤œ 18:00 ã«ç”»é¢ã§ãŠçŸ¥ã‚‰ã›</li>
        <li>ãƒ”ãƒƒã‚¿ãƒªã®æ™‚ã¯ ç·‘è‰² ã§å¼·èª¿</li>
      </ul>
    </li>
    <li>2ï¸âƒ£ <b>é£²ã‚“ã ãƒœã‚¿ãƒ³</b>
      <ul>
        <li>ã€Œé£²ã‚“ã ã€ã‚’æŠ¼ã™ã¨ ãã®æ™‚åˆ»ã‚’è¨˜éŒ²</li>
        <li>è¡¨ç¤ºä¾‹ï¼šğŸ•’ æœ€å¾Œã«é£²ã‚“ã æ™‚é–“ï¼š7:03</li>
        <li>ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã¦ã‚‚è¨˜éŒ²ã¯æ®‹ã‚‹</li>
      </ul>
    </li>
    <li>3ï¸âƒ£ <b>é£²ã¿å¿˜ã‚Œãƒã‚§ãƒƒã‚¯</b>
      <ul>
        <li>æœ8æ™‚ä»¥é™ã«æœè–¬ã‚’é£²ã‚“ã§ã„ãªã„ â†’ èµ¤èƒŒæ™¯ã§è­¦å‘Š</li>
        <li>å¤œ19æ™‚ä»¥é™ã«å¤œè–¬ã‚’é£²ã‚“ã§ã„ãªã„ â†’ èµ¤èƒŒæ™¯ã§è­¦å‘Š</li>
      </ul>
    </li>
    <li>4ï¸âƒ£ <b>é£²ã¿å¿˜ã‚Œãƒ¡ãƒ¼ãƒ«é€šçŸ¥</b>
      <ul>
        <li>é£²ã¿å¿˜ã‚ŒãŸã‚‰ 1å›ã ã‘ãƒ¡ãƒ¼ãƒ«é€ä¿¡</li>
        <li>é£²ã‚“ã ã‚‰ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯ãƒªã‚»ãƒƒãƒˆ</li>
      </ul>
    </li>
    <li>5ï¸âƒ£ <b>è‡ªå‹•æ›´æ–°</b>
      <ul>
        <li>1åˆ†ã”ã¨ã«ç”»é¢ãŒè‡ªå‹•ãƒã‚§ãƒƒã‚¯</li>
        <li>é£²ã¿å¿˜ã‚Œã‚„æ¬¡ã®æœè–¬æ™‚é–“ã‚’è‡ªå‹•è¡¨ç¤º</li>
      </ul>
    </li>
  </ul>
  <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
  <button id="backBtn">â† æˆ»ã‚‹</button>
</div>

<script>
const mainPage = document.getElementById("mainPage");
const featurePage = document.getElementById("featurePage");
const toFeatureBtn = document.getElementById("toFeatureBtn");
const backBtn = document.getElementById("backBtn");

// ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ
toFeatureBtn.addEventListener("click", () => {
  mainPage.classList.add("hidden");
  featurePage.classList.remove("hidden");
});
backBtn.addEventListener("click", () => {
  featurePage.classList.add("hidden");
  mainPage.classList.remove("hidden");
});

// ================= æ—¢å­˜ã‚³ãƒ¼ãƒ‰ =================

const MORNING = 7;
const EVENING = 18;

const message = document.getElementById("timeMessage");
const lastTime = document.getElementById("lastTime");
const btn = document.getElementById("takeBtn");

let lastTaken = localStorage.getItem("lastTaken");

// é£²ã¿å¿˜ã‚Œãƒ¡ãƒ¼ãƒ«é€ä¿¡é–¢æ•°ï¼ˆ1å›ã ã‘ï¼‰
function sendMissedMail(type) {
  const sent = localStorage.getItem("missMailSent");
  if (sent === type) return; // ã™ã§ã«é€ä¿¡æ¸ˆã¿

  emailjs.send(
    "YOUR_SERVICE_ID",
    "YOUR_TEMPLATE_ID",
    {
      message: `âš  ${type}ã®ãŠè–¬ã‚’é£²ã¿å¿˜ã‚Œã¦ã„ã¾ã™`,
      time: new Date().toLocaleString()
    }
  );

  localStorage.setItem("missMailSent", type);
}

// UIæ›´æ–°
function updateUI() {
  const now = new Date();
  const hour = now.getHours();
  const minute = now.getMinutes();

  message.className = "normal";
  message.textContent = "æ¬¡ã®ãŠè–¬æ™‚é–“ã‚’å¾…ã£ã¦ã„ã¾ã™";

  // 7:00 / 18:00 ãƒ”ãƒƒã‚¿ãƒª
  if ((hour === MORNING || hour === EVENING) && minute === 0) {
    message.className = "time-alert";
    message.textContent = "â° ãŠè–¬ã‚’é£²ã‚“ã§ãã ã•ã„ï¼";
  }

  // é£²ã¿å¿˜ã‚Œåˆ¤å®š
  if (lastTaken) {
    const last = new Date(lastTaken);

    // æœã®é£²ã¿å¿˜ã‚Œï¼ˆ8æ™‚ä»¥é™ï¼‰
    if (hour >= 8 && last.getHours() < MORNING) {
      message.className = "missed";
      message.textContent = "âš  æœã®ãŠè–¬ã‚’é£²ã¿å¿˜ã‚Œã¦ã„ã¾ã™";
      sendMissedMail("æœ");
    }

    // å¤œã®é£²ã¿å¿˜ã‚Œï¼ˆ19æ™‚ä»¥é™ï¼‰
    if (hour >= 19 && last.getHours() < EVENING) {
      message.className = "missed";
      message.textContent = "âš  å¤œã®ãŠè–¬ã‚’é£²ã¿å¿˜ã‚Œã¦ã„ã¾ã™";
      sendMissedMail("å¤œ");
    }
  }
}

// é£²ã‚“ã ãƒœã‚¿ãƒ³
btn.addEventListener("click", () => {
  const now = new Date();
  localStorage.setItem("lastTaken", now);
  localStorage.removeItem("missMailSent"); // â†ãƒªã‚»ãƒƒãƒˆã—ã¦ãƒ¡ãƒ¼ãƒ«å†é€å¯èƒ½ã«

  lastTaken = now;
  lastTime.textContent = "ğŸ•’ æœ€å¾Œã«é£²ã‚“ã æ™‚é–“ï¼š" + now.toLocaleTimeString();

  // EmailJSã§é€šå¸¸å ±å‘Šãƒ¡ãƒ¼ãƒ«ï¼ˆä»»æ„ï¼‰
  emailjs.send(
    "service_zmsn0wy",
    "template_tt2bsvq",
    { message: "âœ… è–¬ã‚’é£²ã¿ã¾ã—ãŸ", time: now.toLocaleString() }
  );
});

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è¡¨ç¤º
if (lastTaken) {
  lastTime.textContent =
    "ğŸ•’ æœ€å¾Œã«é£²ã‚“ã æ™‚é–“ï¼š" + new Date(lastTaken).toLocaleTimeString();
}

updateUI();
setInterval(updateUI, 60000); // 1åˆ†ã”ã¨æ›´æ–°
</script>
</body>
</html>
